<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BoredIdiots - 2048</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    body {
      background: linear-gradient(135deg, #a64ca6, #ff66b2);
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin: 0 1rem;
      font-weight: bold;
      font-size: 1.2rem;
    }

    nav a:hover {
      text-decoration: underline;
    }

    h1 {
      margin: 1.5rem 0;
    }

    #game-container {
      display: inline-block;
      margin-top: 20px;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-template-rows: repeat(4, 100px);
      gap: 10px;
      background: #bbada0;
      padding: 10px;
      border-radius: 10px;
      position: relative;
      touch-action: none; /* Disable default gestures */
    }

    .cell {
      width: 100px;
      height: 100px;
      background: rgba(238, 228, 218, 0.35);
      border-radius: 5px;
    }

    .tile {
      position: absolute;
      width: 100px;
      height: 100px;
      line-height: 100px;
      font-size: 2rem;
      font-weight: bold;
      color: #776e65;
      border-radius: 5px;
      text-align: center;
      transition: transform 0.2s ease-in-out;
    }

    .tile-2    { background: #eee4da; }
    .tile-4    { background: #ede0c8; }
    .tile-8    { background: #f2b179; color: white; }
    .tile-16   { background: #f59563; color: white; }
    .tile-32   { background: #f67c5f; color: white; }
    .tile-64   { background: #f65e3b; color: white; }
    .tile-128  { background: #edcf72; color: white; font-size: 1.7rem; }
    .tile-256  { background: #edcc61; color: white; font-size: 1.7rem; }
    .tile-512  { background: #edc850; color: white; font-size: 1.7rem; }
    .tile-1024 { background: #edc53f; color: white; font-size: 1.5rem; }
    .tile-2048 { background: #edc22e; color: white; font-size: 1.5rem; }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="../index.html">Home</a>
      <a href="../games.html">Games</a>
      <a href="../contact.html">Contact</a>
    </nav>
  </header>

  <main>
    <h1>2048</h1>
    <div id="game-container">
      <div id="grid"></div>
    </div>
  </main>

  <script>
    const gridSize = 4;
    let board = Array.from({ length: gridSize }, () => Array(gridSize).fill(0));

    const grid = document.getElementById("grid");

    function initBoard() {
      grid.innerHTML = "";
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        grid.appendChild(cell);
      }
      addRandomTile();
      addRandomTile();
      renderBoard();
    }

    function addRandomTile() {
      let empty = [];
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          if (board[r][c] === 0) empty.push({ r, c });
        }
      }
      if (empty.length === 0) return;
      let { r, c } = empty[Math.floor(Math.random() * empty.length)];
      board[r][c] = Math.random() < 0.9 ? 2 : 4;
    }

    function renderBoard() {
      document.querySelectorAll(".tile").forEach(t => t.remove());
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          if (board[r][c] !== 0) {
            const tile = document.createElement("div");
            tile.className = `tile tile-${board[r][c]}`;
            tile.textContent = board[r][c];
            tile.style.transform = `translate(${c * 110}px, ${r * 110}px)`;
            grid.appendChild(tile);
          }
        }
      }
    }

    function slide(row) {
      row = row.filter(val => val);
      for (let i = 0; i < row.length - 1; i++) {
        if (row[i] === row[i + 1]) {
          row[i] *= 2;
          row[i + 1] = 0;
        }
      }
      row = row.filter(val => val);
      while (row.length < gridSize) row.push(0);
      return row;
    }

    function rotateBoard(times) {
      while (times--) {
        board = board[0].map((_, i) => board.map(row => row[i]).reverse());
      }
    }

    function move(dir) {
      const prev = JSON.stringify(board);

      if (dir === "left") {
        for (let r = 0; r < gridSize; r++) board[r] = slide(board[r]);
      } 
      else if (dir === "right") {
        for (let r = 0; r < gridSize; r++) {
          board[r].reverse();
          board[r] = slide(board[r]);
          board[r].reverse();
        }
      } 
      else if (dir === "up") {
        rotateBoard(1);
        for (let r = 0; r < gridSize; r++) board[r] = slide(board[r]);
        rotateBoard(3);
      } 
      else if (dir === "down") {
        rotateBoard(3);
        for (let r = 0; r < gridSize; r++) board[r] = slide(board[r]);
        rotateBoard(1);
      }

      if (JSON.stringify(board) !== prev) {
        addRandomTile();
      }
      renderBoard();
    }

    // Keyboard controls
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") move("left");
      else if (e.key === "ArrowRight") move("right");
      else if (e.key === "ArrowUp") move("up");
      else if (e.key === "ArrowDown") move("down");
    });

    // Touch controls for mobile (prevent scrolling)
    let touchStartX = 0, touchStartY = 0;
    grid.addEventListener("touchstart", (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }, { passive: false });

    grid.addEventListener("touchend", (e) => {
      const dx = e.changedTouches[0].clientX - touchStartX;
      const dy = e.changedTouches[0].clientY - touchStartY;

      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 30) move("right");
        else if (dx < -30) move("left");
      } else {
        if (dy > 30) move("down");
        else if (dy < -30) move("up");
      }

      e.preventDefault(); // stop screen scrolling while swiping
    }, { passive: false });

    initBoard();
  </script>
</body>
</html>
